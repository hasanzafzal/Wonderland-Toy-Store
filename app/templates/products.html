{% extends "base.html" %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <h1>{% if view_mode == 'categories' %}Our Products{% elif view_mode == 'category' %}{{ category.name }}{% else %}All Products{% endif %}</h1>
        <p>{% if view_mode == 'categories' %}Select a category or view all products{% elif view_mode == 'category' %}Products in {{ category.name }}{% else %}Discover our complete collection{% endif %}</p>
    </div>
</section>

<!-- CATEGORIES VIEW -->
{% if view_mode == 'categories' %}
<!-- Categories Grid -->
<section class="categories-section">
    <div class="container">
        <div class="categories-grid" id="categories-grid">
            {% for category in categories %}
            <a href="{{ url_for('main.category_products', category_id=category.id) }}" class="category-card" data-category-id="{{ category.id }}">
                <div class="category-icon">
                    {% if 'Lego' in category.name %}
                        üß±
                    {% elif 'Toy Cars' in category.name or 'Masito' in category.name %}
                        üöó
                    {% elif 'Plush' in category.name %}
                        üß∏
                    {% elif 'Board' in category.name %}
                        üé≤
                    {% elif 'Arts' in category.name or 'Crafts' in category.name %}
                        üé®
                    {% elif 'Hotwheels' in category.name %}
                        üèéÔ∏è
                    {% elif 'Barbie' in category.name %}
                        üë±üèº‚Äç‚ôÄÔ∏èüéÄ
                    {% elif 'Sports' in category.name or 'Outdoor' in category.name %}
                        üèÄ
                    {% else %}
                        üéÅ
                    {% endif %}
                </div>
                <div class="category-info">
                    <h3 class="category-name">{{ category.name }}</h3>
                    <p class="category-description">{{ category.description }}</p>
                    <span class="product-count">{{ category.products|length }} products</span>
                </div>
            </a>
            {% endfor %}
        </div>
        
        <!-- View All Button -->
        <div class="view-all-container">
            <a href="{{ url_for('main.all_products') }}" class="btn btn-view-all">View All Products</a>
        </div>
    </div>
</section>

<!-- PRODUCTS VIEW -->
{% else %}

<!-- Filter and Sort Section -->
<section class="products-filter-section">
    <div class="container">
        <div class="filter-controls">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search toys..." class="search-input">
                <button class="search-btn">üîç</button>
            </div>
            <div class="sort-controls">
                <select id="sort-select" class="sort-select">
                    <option value="default">Sort by: Featured</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="name">Name: A to Z</option>
                </select>
            </div>
        </div>
        {% if view_mode == 'category' %}
            <a href="{{ url_for('main.products') }}" class="btn btn-back">‚Üê Back to Categories</a>
        {% endif %}
    </div>
</section>

<!-- Products Grid -->
<section class="products-section">
    <div class="container">
        <div class="products-count">
            <span id="product-count">{{ products|length }} products found</span>
        </div>
        <div class="products-grid" id="products-grid">
            {% for product in products %}
            <div class="product-card" data-product-id="{{ product.id }}" data-product-name="{{ product.name }}" data-product-price="{{ product.price }}">
                <div class="product-image">
                    {% if product.image_filename %}
                        <img src="/static/images/products/{{ product.image_filename }}" alt="{{ product.name }}" class="product-img">
                    {% else %}
                        <div class="product-placeholder">üéÅ</div>
                    {% endif %}
                    <div class="product-badge">{{ product.category.name if product.category else 'Toy' }}</div>
                </div>
                <div class="product-info">
                    <h3 class="product-name">{{ product.name }}</h3>
                    <div class="product-details-section" style="display: none;">
                        <div class="product-details-content">
                            <p class="product-full-description">{{ product.description or 'Premium toy product' }}</p>
                            {% if product.stock > 0 %}
                                <p class="product-stock"><strong>Stock:</strong> <span class="stock-available">{{ product.stock }} in stock</span></p>
                            {% else %}
                                <p class="product-stock"><strong>Stock:</strong> <span class="stock-unavailable">Out of stock</span></p>
                            {% endif %}
                        </div>
                    </div>
                    <button class="btn btn-details" onclick="toggleDetails(this)">Show Details</button>
                    <div class="product-footer">
                        <div class="product-price">${{ "%.2f"|format(product.price) }}</div>
                        <div class="product-rating">‚≠ê 4.8</div>
                    </div>
                    {% if current_user.is_authenticated %}
                        <form method="POST" action="{{ url_for('main.add_to_cart', product_id=product.id) }}" class="add-to-cart-form">
                            <div class="quantity-input">
                                <input type="number" name="quantity" value="1" min="1" max="100">
                            </div>
                            <div class="product-actions">
                                <button type="submit" class="btn btn-add-cart">üõí Add to Cart</button>
                            </div>
                        </form>
                        <form method="POST" action="{{ url_for('main.add_to_wishlist', product_id=product.id) }}" class="wishlist-form" style="display:inline;">
                            <button type="submit" class="btn btn-wishlist" title="Add to Wishlist">‚ù§Ô∏è</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('main.login', next=url_for('main.products')) }}" class="btn btn-add-cart">üîê Login to Buy</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- No Results -->
<section id="no-results" class="no-results" style="display: none;">
    <div class="container">
        <div class="no-results-content">
            <p class="no-results-icon">üîç</p>
            <h2>No products found</h2>
            <p>Try adjusting your search or filter criteria</p>
        </div>
    </div>
</section>

{% endif %}

<!-- CTA Section -->
<section class="cta-section">
    <div class="container">
        <h2>Can't find what you're looking for?</h2>
        <p>Check back soon for new arrivals!</p>
        <a href="{{ url_for('main.index') }}" class="btn btn-primary">Back to Home</a>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Search functionality
    const searchInput = document.getElementById('search-input');
    const sortSelect = document.getElementById('sort-select');
    
    if (searchInput) searchInput.addEventListener('keyup', filterProducts);
    if (sortSelect) sortSelect.addEventListener('change', filterProducts);
});

function toggleDetails(button) {
    const productCard = button.closest('.product-card');
    const detailsSection = productCard.querySelector('.product-details-section');
    
    if (detailsSection.style.display === 'none') {
        detailsSection.style.display = 'block';
        button.classList.add('active');
        button.textContent = 'Hide Details';
    } else {
        detailsSection.style.display = 'none';
        button.classList.remove('active');
        button.textContent = 'Show Details';
    }
}

function filterProducts() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const sortBy = document.getElementById('sort-select').value;
    const cards = Array.from(document.querySelectorAll('.product-card'));
    
    // Filter by search
    const filtered = cards.filter(card => {
        const name = card.dataset.productName.toLowerCase();
        return name.includes(searchTerm);
    });
    
    // Sort
    if (sortBy === 'price-low') {
        filtered.sort((a, b) => parseFloat(a.dataset.productPrice) - parseFloat(b.dataset.productPrice));
    } else if (sortBy === 'price-high') {
        filtered.sort((a, b) => parseFloat(b.dataset.productPrice) - parseFloat(a.dataset.productPrice));
    } else if (sortBy === 'name') {
        filtered.sort((a, b) => a.dataset.productName.localeCompare(b.dataset.productName));
    }
    
    // Update display
    const grid = document.getElementById('products-grid');
    const noResults = document.getElementById('no-results');
    const count = document.getElementById('product-count');
    
    if (filtered.length === 0) {
        grid.style.display = 'none';
        noResults.style.display = 'block';
        count.textContent = '0 products found';
    } else {
        grid.innerHTML = '';
        filtered.forEach(card => grid.appendChild(card));
        noResults.style.display = 'none';
        count.textContent = `${filtered.length} products found`;
    }
}
</script>

<style>
.page-header {
    background: linear-gradient(135deg, #FF8700 0%, #CC6B00 100%);
    color: white;
    padding: 3rem 0;
    text-align: center;
}

.page-header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
}

/* CATEGORIES STYLES */
.categories-section {
    padding: 3rem 0;
    background-color: white;
}

.categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.category-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
    border: 2px solid #eee;
    border-radius: 12px;
    text-decoration: none;
    color: inherit;
    transition: all 0.3s ease;
    cursor: pointer;
}

.category-card:hover {
    border-color: #FF8700;
    box-shadow: 0 8px 24px rgba(255, 135, 0, 0.2);
    transform: translateY(-5px);
}

.category-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.category-info {
    text-align: center;
}

.category-name {
    font-size: 1.3rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
}

.category-description {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 0.8rem;
    line-height: 1.4;
}

.product-count {
    display: inline-block;
    background: #FF8700;
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.view-all-container {
    display: flex;
    justify-content: center;
    margin-top: 2rem;
}

.btn-view-all {
    padding: 1rem 2.5rem;
    background: linear-gradient(135deg, #FF8700 0%, #CC6B00 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.3s;
    display: inline-block;
}

.btn-view-all:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 135, 0, 0.3);
}

.btn-back {
    padding: 0.6rem 1.2rem;
    background: #f0f0f0;
    color: #333;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.3s;
    display: inline-block;
}

.btn-back:hover {
    background: #e0e0e0;
}

/* PRODUCTS STYLES */
.products-filter-section {
    padding: 2rem 0;
    background-color: white;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.filter-controls {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
    align-items: center;
    flex: 1;
}

.search-box {
    flex: 1;
    min-width: 250px;
    display: flex;
    gap: 0.5rem;
}

.search-input {
    flex: 1;
    padding: 0.8rem 1rem;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s;
}

.search-input:focus {
    outline: none;
    border-color: #FF8700;
    box-shadow: 0 0 0 3px rgba(255, 135, 0, 0.1);
}

.search-btn {
    padding: 0.8rem 1.2rem;
    background: #FF8700;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
}

.sort-select {
    padding: 0.8rem 1rem;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
}

.products-section {
    padding: 3rem 0;
    background-color: white;
}

.products-count {
    margin-bottom: 2rem;
    font-weight: 600;
    color: #666;
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
}

.product-card {
    display: flex;
    flex-direction: column;
    background: white;
    border: 1px solid #eee;
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.product-card:hover {
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    transform: translateY(-5px);
}

.product-image {
    position: relative;
    background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
    padding: 2rem;
    text-align: center;
    font-size: 2.5rem;
    height: 250px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.product-img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.product-placeholder {
    font-size: 3rem;
}

.product-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--primary-color);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.product-info {
    flex: 1;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
}

.product-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
}

.product-description {
    color: #666;
    font-size: 0.85rem;
    margin-bottom: 1rem;
    flex-grow: 1;
}

.product-short-description {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.product-details-section {
    background: #f8f9fa;
    border: 1px solid #eee;
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1rem;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        max-height: 0;
    }
    to {
        opacity: 1;
        max-height: 500px;
    }
}

.product-details-content {
    font-size: 0.85rem;
}

.product-full-description {
    color: #555;
    line-height: 1.5;
    margin-bottom: 0.8rem;
    word-wrap: break-word;
}

.product-stock {
    color: #555;
    margin: 0;
}

.stock-available {
    color: #28a745;
    font-weight: 600;
}

.stock-unavailable {
    color: #dc3545;
    font-weight: 600;
}

.btn-more-details {
    padding: 0.6rem 1rem;
    background: #f0f0f0;
    color: #333;
    border: 1px solid #ddd;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s;
    margin-bottom: 1rem;
    width: 100%;
}

.btn-more-details:hover {
    background: #e0e0e0;
    border-color: #FF8700;
}

.btn-more-details.active {
    background: #FF8700;
    color: white;
    border-color: #FF8700;
}

.btn-details {
    padding: 0.5rem 1rem;
    background: transparent;
    color: #FF8700;
    border: 1.5px solid #FF8700;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 600;
    transition: all 0.2s;
    margin-bottom: 0.8rem;
    width: 100%;
}

.btn-details:hover {
    background: #FF8700;
    color: white;
    transform: scale(1.02);
}

.btn-details.active {
    background: #FF8700;
    color: white;
}

.product-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    min-height: 2rem;
}

.product-price {
    font-size: 1.4rem;
    font-weight: 700;
    color: #FF8700;
}

.product-rating {
    color: #f59e0b;
    font-size: 0.9rem;
}

.no-results {
    padding: 3rem 0;
}

.no-results-content {
    text-align: center;
}

.no-results-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.cta-section {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-align: center;
    padding: 3rem 0;
    margin-top: 2rem;
}

.cta-section h2 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.add-to-cart-form {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    width: 100%;
    margin-bottom: 0;
}

.product-actions {
    display: flex;
    gap: 0.5rem;
    width: 100%;
    height: 2.6rem;
}

.quantity-input input {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    text-align: center;
    height: 2.6rem;
}
}

.btn-add-cart {
    flex: 1;
    padding: 0.8rem 1rem;
    background: linear-gradient(135deg, #FF8700 0%, #CC6B00 100%);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    height: 2.6rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-add-cart:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 135, 0, 0.4);
}

.btn-wishlist {
    flex: 0 0 45px;
    padding: 0.8rem;
    background: white;
    color: #FF8700;
    border: 2px solid #FF8700;
    border-radius: 5px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.3s;
}

.btn-wishlist:hover {
    background: #FF8700;
    color: white;
    transform: scale(1.1);
}
</style>
{% endblock %}
